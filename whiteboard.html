<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Smart Whiteboard</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      height: 100vh;
      display: flex;
      flex-direction: column;
      background: #f5f5f5;
    }

    #toggleToolbarBtn {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 1000;
      padding: 6px 12px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    #toolbar {
      display: flex;
      flex-wrap: nowrap;
      gap: 10px;
      overflow-x: auto;
      padding: 10px;
      background: #ffffff;
      border-bottom: 1px solid #ccc;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      position: fixed;
      top: 50px;
      left: 0;
      right: 0;
      z-index: 999;
    }

    fieldset {
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap;
      gap: 6px;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      white-space: nowrap;
    }

    legend {
      font-size: 14px;
      font-weight: bold;
    }

    .tool, .color, .btn {
      padding: 6px 10px;
      font-size: 14px;
      cursor: pointer;
      border: 2px solid transparent;
      border-radius: 6px;
      background: #f1f1f1;
      transition: 0.2s ease;
    }

    .tool:hover, .color:hover, .btn:hover {
      background-color: #ddd;
    }

    .tool.active, .color.active {
      border-color: #333;
      background: #ddd;
    }

    .color {
      width: 24px;
      height: 24px;
    }

    canvas {
      flex: 1;
      margin-top: 120px;
      border: 1px solid #ccc;
      cursor: crosshair;
    }

    input[type="number"], select {
      padding: 4px;
      font-size: 14px;
      border-radius: 4px;
      border: 1px solid #aaa;
    }

    #imageUpload {
      display: none;
    }
  </style>
</head>
<body>

<button id="toggleToolbarBtn">🧰 Hide Toolbar</button>

<div id="toolbar">
  <fieldset>
    <legend>Tools</legend>
    <button class="tool active" data-tool="pen">✏️</button>
    <button class="tool" data-tool="rect">⬛</button>
    <button class="tool" data-tool="circle">⚪</button>
    <button class="tool" data-tool="line">📏</button>
    <button class="tool" data-tool="text">🔤</button>
    <button class="tool" data-tool="image">🖼️</button>
    <button class="tool" data-tool="select">🖱️</button>
    <button class="tool" data-tool="resize">🔲</button>
    <button class="tool" data-tool="group">🧩</button>
  </fieldset>

  <fieldset>
    <legend>Color</legend>
    <div class="color active" style="background:black" data-color="black"></div>
    <div class="color" style="background:red" data-color="red"></div>
    <div class="color" style="background:blue" data-color="blue"></div>
    <div class="color" style="background:green" data-color="green"></div>
  </fieldset>

  <fieldset>
    <legend>Text</legend>
    <input type="number" id="fontSize" value="20" style="width:50px;">
    <select id="fontFamily">
      <option value="Arial">Arial</option>
      <option value="Courier New">Courier</option>
      <option value="Georgia">Georgia</option>
      <option value="Verdana">Verdana</option>
    </select>
  </fieldset>

  <fieldset>
    <legend>Page</legend>
    <select id="pageSelector"></select>
    <button class="btn" onclick="newPage()">➕</button>
    <button class="btn" onclick="deletePage()">❌</button>
  </fieldset>
<fieldset>
  <legend>Actions</legend>
  <button class="btn" onclick="undo()">↩️ Undo</button>
  <button class="btn" onclick="redo()">↪️ Redo</button>
  <button class="btn" onclick="clearBoard()">🧹 Clear</button>
  <button class="btn" onclick="savePage()">💾 Save</button>
  <button class="btn" onclick="exportPNG()">🖼️ PNG</button>
  <button class="btn" onclick="exportPDF()">📄 PDF</button>
</fieldset>


  <input id="imageUpload" type="file" accept="image/*">
</div>

<canvas id="canvas"></canvas>

<!-- jsPDF CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- Whiteboard Script -->
<script>
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight - 120;

  let tool = 'pen', color = 'black', fontSize = 20, fontFamily = 'Arial';
  let drawing = false, startX = 0, startY = 0;
  let currentObject = null, selectedObject = null, groupSelection = [];
  let objects = [], undoStack = [], redoStack = [], currentPage = 'Page 1';
  let dragOffset = { x: 0, y: 0 };

  document.querySelectorAll('.tool').forEach(btn => {
    btn.onclick = () => {
      document.querySelectorAll('.tool').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      tool = btn.dataset.tool;
    };
  });
  document.querySelectorAll('.color').forEach(btn => {
    btn.onclick = () => {
      document.querySelectorAll('.color').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      color = btn.dataset.color;
    };
  });
  document.getElementById('fontSize').onchange = e => fontSize = parseInt(e.target.value);
  document.getElementById('fontFamily').onchange = e => fontFamily = e.target.value;

  canvas.onmousedown = e => {
    startX = e.offsetX;
    startY = e.offsetY;
    if (tool === 'select' || tool === 'resize') {
      selectedObject = objects.findLast(obj => isInside(obj, startX, startY));
      if (selectedObject) {
        dragOffset = { x: startX - selectedObject.x, y: startY - selectedObject.y };
        drawing = true;
      }
    } else if (tool === 'group') {
      groupSelection = [];
      objects.forEach(obj => {
        if (isInside(obj, startX, startY)) groupSelection.push(obj);
      });
    } else if (tool === 'pen') {
      currentObject = { tool: 'pen', color, points: [{ x: startX, y: startY }] };
      drawing = true;
    } else if (tool === 'text') {
      const text = prompt("Enter text:");
      if (text) {
        const obj = { tool: 'text', x: startX, y: startY, text, color, fontSize, fontFamily };
        objects.push(obj); saveState(); savePage(); render();
      }
    } else if (tool === 'image') {
      document.getElementById('imageUpload').click();
    } else {
      currentObject = { tool, x: startX, y: startY, x2: startX, y2: startY, color };
      drawing = true;
    }
  };

  canvas.onmousemove = e => {
    if (!drawing) return;
    const x = e.offsetX, y = e.offsetY;
    if (tool === 'pen') {
      currentObject.points.push({ x, y }); render(); drawObject(currentObject);
    } else if (tool === 'select' && selectedObject) {
      selectedObject.x = x - dragOffset.x;
      selectedObject.y = y - dragOffset.y;
      render();
    } else if (tool === 'resize' && selectedObject) {
      selectedObject.w = x - selectedObject.x;
      selectedObject.h = y - selectedObject.y;
      selectedObject.x2 = x; selectedObject.y2 = y;
      render();
    } else {
      currentObject.x2 = x; currentObject.y2 = y;
      render(); drawObject(currentObject);
    }
  };

  canvas.onmouseup = () => {
    if (drawing && currentObject) {
      if (tool !== 'select' && tool !== 'resize') {
        objects.push(currentObject); saveState(); savePage(); render();
      }
    }
    drawing = false; currentObject = null; selectedObject = null;
  };

  function drawObject(obj) {
    ctx.strokeStyle = ctx.fillStyle = obj.color || 'black';
    switch (obj.tool) {
      case 'pen': ctx.beginPath();
        ctx.moveTo(obj.points[0].x, obj.points[0].y);
        obj.points.forEach(p => ctx.lineTo(p.x, p.y)); ctx.stroke(); break;
      case 'rect': ctx.strokeRect(obj.x, obj.y, obj.x2 - obj.x, obj.y2 - obj.y); break;
      case 'circle':
        let r = Math.hypot(obj.x2 - obj.x, obj.y2 - obj.y);
        ctx.beginPath(); ctx.arc(obj.x, obj.y, r, 0, 2 * Math.PI); ctx.stroke(); break;
      case 'line': ctx.beginPath(); ctx.moveTo(obj.x, obj.y); ctx.lineTo(obj.x2, obj.y2); ctx.stroke(); break;
      case 'text':
        ctx.font = `${obj.fontSize}px ${obj.fontFamily}`;
        ctx.fillText(obj.text, obj.x, obj.y); break;
      case 'image':
        let img = new Image(); img.src = obj.src;
        img.onload = () => ctx.drawImage(img, obj.x, obj.y, obj.w, obj.h); break;
    }
  }

  function isInside(obj, x, y) {
    if (obj.tool === 'text') {
      ctx.font = `${obj.fontSize}px ${obj.fontFamily}`;
      const width = ctx.measureText(obj.text).width, height = obj.fontSize;
      return x >= obj.x && x <= obj.x + width && y <= obj.y && y >= obj.y - height;
    }
    if (obj.tool === 'image') {
      return x >= obj.x && x <= obj.x + (obj.w || 150) && y >= obj.y && y <= obj.y + (obj.h || 100);
    }
    if (obj.tool === 'pen') {
      return obj.points.some(p => Math.hypot(p.x - x, p.y - y) < 5);
    }
    const left = Math.min(obj.x, obj.x2), right = Math.max(obj.x, obj.x2);
    const top = Math.min(obj.y, obj.y2), bottom = Math.max(obj.y, obj.y2);
    return x >= left && x <= right && y >= top && y <= bottom;
  }

  function render() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (const obj of objects) drawObject(obj);
  }

  function saveState() {
    undoStack.push(JSON.stringify(objects)); redoStack = [];
  }
  function undo() {
    if (undoStack.length > 0) {
      redoStack.push(JSON.stringify(objects));
      objects = JSON.parse(undoStack.pop()); savePage(); render();
    }
  }
  function redo() {
    if (redoStack.length > 0) {
      undoStack.push(JSON.stringify(objects));
      objects = JSON.parse(redoStack.pop()); savePage(); render();
    }
  }
  function clearBoard() {
    if (confirm("Clear current page?")) {
      objects = []; undoStack = []; redoStack = [];
      savePage(); render();
    }
  }

  function savePage() {
    localStorage.setItem("wb_" + currentPage, JSON.stringify(objects));
    updatePageSelector();
  }
  function loadPageList() {
    const selector = document.getElementById("pageSelector");
    selector.innerHTML = '';
    let found = false;
    for (let key in localStorage) {
      if (key.startsWith("wb_")) {
        const name = key.substring(3);
        const option = document.createElement("option");
        option.value = name; option.text = name;
        selector.appendChild(option);
        if (!found) { currentPage = name; found = true; }
      }
    }
    selector.value = currentPage;
    selector.onchange = () => {
      currentPage = selector.value;
      const data = localStorage.getItem("wb_" + currentPage);
      objects = data ? JSON.parse(data) : []; undoStack = []; redoStack = [];
      render();
    };
    if (found) {
      const data = localStorage.getItem("wb_" + currentPage);
      objects = data ? JSON.parse(data) : []; render();
    } else {
      currentPage = "Page 1"; savePage();
    }
  }
  function updatePageSelector() {
    const selector = document.getElementById("pageSelector");
    const currentVal = selector.value;
    loadPageList(); selector.value = currentVal;
  }
  function newPage() {
    const name = prompt("New page name:"); if (!name) return;
    if (localStorage.getItem("wb_" + name)) return alert("Already exists");
    currentPage = name; objects = []; undoStack = []; redoStack = [];
    savePage(); loadPageList();
  }
  function deletePage() {
    if (!confirm("Delete current page?")) return;
    localStorage.removeItem("wb_" + currentPage);
    loadPageList();
  }

  function exportPNG() {
    const link = document.createElement('a');
    link.download = `${currentPage}.png`;
    link.href = canvas.toDataURL(); link.click();
  }

  function exportPDF() {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();
    const imgData = canvas.toDataURL("image/png");
    pdf.addImage(imgData, 'PNG', 10, 10, 180, 150);
    pdf.save(`${currentPage}.pdf`);
  }

  document.getElementById('imageUpload').addEventListener('change', function () {
    const file = this.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
      const img = new Image();
      img.onload = () => {
        const obj = { tool: 'image', x: startX, y: startY, w: 150, h: 100, src: e.target.result };
        objects.push(obj); saveState(); savePage(); render();
      };
      img.src = e.target.result;
    };
    reader.readAsDataURL(file);
  });

  window.addEventListener('keydown', (e) => {
    if ((e.key === 'Delete' || e.key === 'Backspace') && selectedObject) {
      const index = objects.indexOf(selectedObject);
      if (index > -1) {
        objects.splice(index, 1);
        selectedObject = null; saveState(); savePage(); render();
      }
    }
  });

  // Show/hide toolbar
  const toggleBtn = document.getElementById('toggleToolbarBtn');
  const toolbar = document.getElementById('toolbar');
  let toolbarVisible = true;
  toggleBtn.onclick = () => {
    toolbarVisible = !toolbarVisible;
    toolbar.style.display = toolbarVisible ? 'flex' : 'none';
    toggleBtn.innerText = toolbarVisible ? '🧰 Hide Toolbar' : '🧰 Show Toolbar';
  };

  loadPageList();
</script>
</body>
</html>inhance the code and working all the buttones and funcnality of code 